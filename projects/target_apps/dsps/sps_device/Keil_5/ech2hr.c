// EcgToHR.cpp : 콘솔 응용 프로그램에 대한 진입점을 정의합니다.
//

#include "stdafx.h"
#include "ecgtohr.h"
//#include "systick.h"
#include "gpio.h"
const int ecg[2000]={1490,1485,1482,1487,1480,1469,1471,1468,1476,1487,1507,1514,1516,1522,1518,1523,1528,1532,1523,1516,1517,1510,1508,1491,1469,1442,1405,1361,1321,1269,1224,1172,1117,1068,1002,951,921,905,892,876,868,866,869,874,869,863,858,854,850,860,866,874,886,900,909,929,954,966,974,976,979,972,986,989,991,978,974,979,999,1022,1033,1050,1067,1084,1105,1122,1136,1138,1142,1143,1153,1165,1178,1187,1191,1208,1211,1223,1215,1221,1225,1232,1242,1252,1263,1264,1271,1272,1282,1303,1340,1370,1398,1431,1445,1446,1433,1416,1394,1385,1375,1372,1370,1363,1360,1351,1348,1352,1364,1370,1366,1356,1344,1327,1315,1316,1316,1327,1330,1335,1343,1345,1344,1336,1328,1318,1316,1304,1292,1294,1294,1293,1283,1268,1251,1242,1231,1234,1251,1262,1275,1275,1269,1261,1253,1234,1210,1213,1214,1230,1239,1246,1253,1251,1250,1240,1246,1242,1247,1250,1245,1246,1239,1234,1217,1215,1213,1227,1230,1229,1231,1241,1247,1234,1218,1201,1191,1179,1169,1175,1178,1178,1168,1157,1149,1154,1163,1176,1179,1181,1190,1190,1195,1198,1192,1189,1188,1192,1196,1200,1205,1214,1243,1291,1376,1482,1593,1701,1749,1692,1520,1276,1048,855,812,828,888,979,1079,1128,1157,1175,1181,1189,1195,1209,1211,1207,1204,1199,1207,1225,1240,1250,1255,1259,1246,1238,1236,1234,1234,1240,1249,1261,1266,1266,1272,1271,1283,1284,1289,1286,1296,1311,1319,1332,1337,1348,1356,1374,1393,1402,1415,1420,1421,1423,1431,1443,1445,1456,1449,1443,1417,1397,1375,1341,1308,1264,1242,1191,1145,1094,1025,946,897,863,834,813,797,790,783,783,789,783,781,780,780,784,795,821,841,854,862,871,878,886,900,914,928,945,968,982,1007,1012,1038,1055,1063,1070,1068,1075,1085,1104,1121,1140,1153,1160,1159,1156,1171,1178,1189,1192,1193,1190,1193,1197,1202,1200,1188,1184,1180,1193,1207,1214,1215,1214,1212,1222,1229,1239,1261,1266,1282,1277,1262,1255,1252,1261,1260,1246,1249,1250,1261,1263,1271,1260,1254,1255,1253,1258,1268,1270,1277,1283,1280,1284,1279,1290,1304,1321,1333,1339,1344,1346,1345,1354,1374,1383,1392,1392,1395,1387,1378,1367,1358,1343,1339,1351,1354,1363,1367,1376,1374,1369,1370,1375,1375,1379,1381,1378,1373,1373,1380,1381,1381,1388,1386,1391,1390,1392,1378,1368,1369,1367,1367,1358,1343,1324,1308,1297,1300,1286,1275,1263,1256,1257,1264,1259,1239,1236,1233,1249,1262,1268,1277,1265,1260,1252,1246,1235,1230,1216,1212,1217,1242,1258,1291,1332,1388,1468,1562,1659,1748,1781,1721,1554,1309,1094,909,857,878,933,1029,1103,1168,1216,1260,1283,1301,1313,1315,1323,1319,1310,1304,1302,1303,1311,1316,1318,1323,1321,1322,1319,1318,1321,1330,1339,1340,1344,1337,1330,1322,1332,1329,1335,1341,1355,1359,1357,1366,1367,1375,1379,1391,1390,1393,1401,1411,1416,1415,1416,1408,1406,1405,1402,1390,1373,1352,1334,1306,1271,1234,1185,1137,1081,1032,945,897,855,823,794,772,759,742,727,710,700,692,691,704,710,731,746,765,780,792,811,830,842,851,863,874,889,905,916,921,923,933,940,951,963,991,1014,1036,1052,1069,1081,1096,1113,1116,1121,1132,1145,1153,1168,1172,1178,1180,1190,1191,1202,1205,1216,1231,1239,1235,1222,1225,1237,1233,1242,1236,1223,1212,1213,1210,1225,1236,1250,1261,1271,1275,1277,1282,1286,1304,1303,1298,1292,1296,1303,1313,1321,1316,1308,1300,1297,1300,1305,1321,1325,1322,1308,1310,1310,1321,1338,1340,1335,1329,1334,1336,1342,1340,1342,1337,1328,1318,1320,1322,1326,1335,1329,1324,1319,1318,1321,1328,1347,1367,1380,1378,1375,1359,1345,1339,1339,1338,1335,1338,1330,1331,1332,1338,1337,1342,1347,1348,1343,1331,1324,1313,1312,1311,1305,1302,1300,1294,1283,1274,1265,1264,1261,1264,1265,1263,1262,1257,1251,1253,1245,1244,1251,1254,1257,1255,1249,1236,1232,1237,1247,1253,1264,1270,1292,1323,1375,1453,1549,1653,1749,1791,1740,1580,1345,1138,965,910,921,998,1094,1166,1222,1250,1254,1252,1260,1270,1285,1296,1300,1303,1302,1302,1311,1316,1315,1315,1320,1322,1318,1315,1309,1302,1308,1319,1328,1342,1349,1356,1347,1335,1330,1328,1337,1348,1371,1386,1394,1402,1405,1414,1426,1446,1461,1473,1475,1468,1459,1452,1455,1456,1455,1453,1457,1450,1436,1415,1378,1336,1289,1247,1197,1150,1092,1052,987,944,915,881,855,839,837,827,826,827,833,837,845,851,852,856,852,857,864,874,891,903,913,917,934,946,970,995,1019,1042,1052,1065,1064,1067,1064,1068,1068,1077,1091,1100,1105,1108,1123,1127,1135,1138,1147,1155,1164,1179,1184,1186,1185,1196,1192,1190,1184,1178,1175,1176,1187,1194,1209,1219,1232,1245,1252,1257,1267,1258,1254,1263,1263,1266,1256,1248,1247,1263,1295,1309,1323,1322,1330,1327,1325,1319,1311,1304,1305,1324,1346,1374,1402,1424,1431,1437,1438,1426,1402,1385,1384,1380,1386,1379,1386,1379,1379,1384,1389,1381,1368,1355,1347,1350,1358,1361,1354,1349,1355,1363,1366,1353,1343,1331,1328,1330,1324,1318,1313,1319,1315,1309,1299,1296,1290,1285,1283,1275,1269,1263,1261,1265,1268,1273,1281,1272,1264,1261,1263,1268,1269,1266,1264,1267,1268,1270,1260,1251,1241,1226,1212,1208,1207,1210,1206,1193,1185,1169,1166,1153,1158,1152,1155,1156,1161,1169,1177,1188,1182,1188,1183,1190,1192,1191,1189,1181,1170,1156,1148,1145,1166,1206,1276,1355,1449,1553,1654,1708,1676,1522,1282,1041,841,775,792,854,940,1043,1090,1114,1136,1149,1164,1182,1193,1206,1204,1202,1208,1217,1229,1235,1230,1223,1228,1231,1235,1234,1231,1238,1258,1259,1264,1271,1269,1280,1289,1297,1304,1309,1316,1324,1330,1327,1334,1352,1369,1395,1424,1442,1440,1428,1415,1422,1430,1438,1447,1444,1446,1440,1430,1412,1392,1376,1349,1329,1293,1259,1205,1150,1092,1042,955,901,860,840,824,810,798,770,750,741,746,748,748,752,766,776,779,788,804,815,829,842,856,868,879,894,907,930,955,971,972,976,980,994,1018,1031,1053,1066,1069,1072,1088,1097,1114,1123,1134,1140,1144,1157,1165,1176,1183,1194,1186,1183,1181,1189,1194,1201,1210,1212,1215,1220,1226,1222,1225,1233,1232,1227,1222,1227,1237,1238,1234,1229,1227,1229,1238,1236,1246,1253,1259,1275,1273,1270,1256,1240,1230,1238,1260,1270,1278,1273,1272,1271,1264,1260,1270,1279,1293,1306,1316,1317,1316,1315,1309,1306,1305,1315,1318,1320,1319,1317,1314,1312,1318,1321,1311,1309,1317,1341,1369,1391,1404,1404,1406,1427,1462,1508,1545,1559,1566,1547,1532,1518,1515,1506,1494,1484,1461,1445,1428,1421,1403,1394,1383,1377,1374,1367,1359,1346,1332,1322,1330,1334,1338,1338,1344,1339,1330,1322,1312,1299,1284,1268,1259,1257,1259,1241,1232,1218,1213,1218,1215,1213,1204,1201,1184,1178,1177,1184,1190,1187,1187,1179,1177,1171,1177,1166,1163,1162,1175,1181,1183,1187,1198,1232,1301,1390,1483,1579,1666,1709,1662,1495,1254,1019,846,792,811,866,941,1048,1096,1137,1147,1156,1161,1169,1176,1179,1187,1188,1197,1205,1217,1218,1209,1197,1192,1192,1200,1212,1219,1216,1215,1220,1224,1232,1242,1234,1242,1254,1267,1284,1292,1297,1302,1310,1316,1330,1348,1363,1376,1376,1374,1364,1376,1393,1420,1432,1438,1441,1429,1410,1386,1374,1364,1358,1345,1323,1290,1252,1212,1169,1120,1064,990,929,886,858,833,808,789,784,776,778,782,799,810,825,835,846,857,872,898,907,914,916,933,944,965,977,1008,1014,1019,1031,1041,1059,1073,1092,1102,1099,1098,1107,1117,1139,1160,1179,1181,1179,1177,1182,1185,1192,1200,1203,1202,1201,1207,1206,1214,1226,1227,1225,1213,1219,1232,1242,1248,1256,1253,1254,1252,1256,1259,1257,1259,1258,1254,1251,1261,1263,1269,1270,1270,1262,1251,1254,1275,1298,1312,1312,1299,1292,1290,1289,1298,1296,1296,1294,1293,1291,1284,1288,1286,1298,1299,1304,1298,1296,1293,1305,1310,1310,1316,1320,1323,1324,1319,1311,1299,1283,1271,1272,1280,1298,1316,1320,1311,1289,1279,1271,1283,1295,1309,1313,1315,1316,1321,1326,1324,1320,1312,1314,1320,1324,1313,1303,1288,1280,1277,1274,1269,1268,1262,1253,1251,1250,1253,1262,1269,1278,1279,1269,1266,1264,1254,1247,1239,1230,1226,1226,1221,1215,1209,1214,1214,1232,1262,1310,1382,1477,1577,1669,1731,1712,1591,1359,1114,896,820,829,878,961,1060,1120,1160,1183,1194,1197,1201,1201,1206,1205,1214,1206,1203,1203,1212,1224,1237,1250,1255,1260,1255,1246,1230,1221,1229,1248,1258,1264,1273,1267,1271,1288,1305,1325,1335,1345,1344,1360,1380,1410,1417,1419,1418,1432,1458,1476,1492,1492,1498,1503,1510,1511,1505,1506,1490,1482,1460,1430,1389,1344,1299,1247,1202,1156,1122,1073,996,932,891,867,845,843,825,818,810,822,825,829,828,830,839,846,864,878,904,923,946,959,966,971,970,970,975,998,1000,1009,1010,1024,1044,1065,1086,1107,1119,1135,1138,1145,1147,1160,1177,1188,1189,1182,1175,1174,1173,1177,1183,1188,1193,1202,1205,1208,1209,1218,1217,1218,1206,1212,1206,1218,1233,1241,1231,1226,1226,1238,1262,1271,1275,1267,1259,1254,1257,1255,1257,1265,1259,1264,1263,1268,1269,1274,1278,1282,1281,1287,1290,1290,1285,1283,1289,1296,1296,1298,1298,1299,1298,1296,1301,1301,1307,1304,1308,1295,1290,1291,1302,1317,1324,1322,1312,1314,1320,1331,1336,1336,1329,1319,1314,1308,1322,1340,1345,1340,1325,1309,1306,1315,1321,1328,1323,1320,1322,1330,1337,1345,1355,1351,1358,1353,1355,1340,1335,1331,1333,1328,1319,1320,1307,1306,1303,1313,1315,1320,1315,1304,1282,1265,1264,1275,1281,1289,1288,1286,1284,1294,1316,1331,1344,1343,1327,1305,1306,1335,1398,1479,1576,1683,1780,1845,1812,1667,1436,1202,1034,941,955,1046,1117,1186,1226,1246,1260,1254,1251,1250,1250,1246,1255,1263,1273,1280,1284,1296,1302,1304,1302,1302,1305,1309,1304,1299,1285,1284,1293,1307,1310,1314,1313,1314,1320,1324,1331,1331,1328,1337,1362,1380,1400,1402,1398,1388,1388,1399,1431,1450,1466,1471,1465,1454,1437,1431,1415,1406,1398,1388,1365,1328,1282,1225,1168,1118,1073,1018,953,911,871,832,792,764,757,755,757,756,768,767,771,772,772,775,773,790,800,830,850,866,862,849,847,859,886,916,946,957,969,967,976,981,993,1018,1046,1063,1068,1076,1071,1074,1077,1089,1096,1101,1116,1141,1164,1178,1177,1171,1160,1154,1148,1154,1159,1163,1171,1182,1187,1192,1196,1201,1206,1216,1225,1222,1219,1213,1216,1215,1214,1214,1212,1208,1208,1217,1243,1257,1270,1270,1268,1263,1266,1274,1280,1279,1277,1282,1284,1292,1291,1296,1300,1301,1299,1302,1300,1294,1290,1278,1275,1274,1279,1284,1288,1288,1286,1294,1298,1294,1279,1269,1269,1278,1278,1282,1294,1300,1296,1286,1282,1278,1284,1286,1288,1283,1272,1267,1262,1262,1267};
uint16_t rri;
uint16_t cnt;
void ecg2hr() 
{
//	printf("hello\n");

//	float raw = 0;
	int rri_pre = 0;
	
	static int i=0;
		
			rri_pre = getRRI(ecg[i]);

		if (rri_pre != 0) 
		{
			rri = rri_pre;
			cnt++;
		}
	GPIO_SetActive(GPIO_PORT_2, GPIO_PIN_0);
	GPIO_SetInactive(GPIO_PORT_2, GPIO_PIN_0);
	i++;
	if(i>1999) i=0;
/*
	for (int i = 0; i < 6500; i++) 	
	{
		hr = getHR(ecg[i]);
		systick_wait(4000); 
		GPIO_SetActive(GPIO_PORT_2, GPIO_PIN_0);
		GPIO_SetInactive(GPIO_PORT_2, GPIO_PIN_0);
	//	if (hr != 0) 
	//	{
	//		raw = getAmplitude();
		//	printf("\n[HR]%d, amp:%f\n", hr, raw);
	//	}
	}

	raw = 0;
	int rri = 0;

	for (int i = 0; i < 9500; i++) {
		rri = getRRI(ecg[i]);

		if (rri != 0) {
			raw = getAmplitude();
			printf("[RRI]%d, amp:%f\n", rri, raw);
		}
	}
*/
}
